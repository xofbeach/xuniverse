<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.xuniverse.front.user.XuniverseUserMapper">
	<select id="checkLoginUser" resultType="java.lang.String">
		SELECT HEX(USER_ID)
		FROM XUNIVERSE.TB_USER TU
		WHERE EXTERNAL_ID = #{externalId}
	</select>

	<insert id="registerUser">
		INSERT INTO XUNIVERSE.TB_USER (
			USER_ID,
			EXTERNAL_ID,
			PROVIDER,
			NICKNAME,
			EMAIL,
			FIRST_LOGIN_DATE,
			LAST_LOGIN_DATE,
			SESSION_ID
		) VALUES (
			UNHEX(REPLACE(UUID(),'-','')),
			#{externalId},
			#{provider},
			#{nickname},
			'--------@-----.---',
			NOW(),
			NOW(),
			#{sessionId}
		)
	</insert>

	<update id="updateLogin">
		UPDATE XUNIVERSE.TB_USER SET
			LAST_LOGIN_DATE = NOW(),
			SESSION_ID = #{sessionId}
		WHERE USER_ID = UNHEX(#{userId})
	</update>
</mapper>
